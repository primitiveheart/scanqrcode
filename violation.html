<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>违规举报</title>
		
		<!-- Add to homescreen for Chrome on Android -->
		<meta name="mobile-web-app-capable" content="yes">
		<link rel="icon" sizes="192x192" href="img/app-icon72x72@2x.png">
		
		<!-- Add to homescreen for Safari on iOS -->
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-title" content="Amaze UI"/>
		<link rel="apple-touch-icon-precomposed" href="img/app-icon72x72@2x.png">
		
		<!-- Tile icon for Win8 (144x144 + tile color) -->
		<meta name="msapplication-TileImage" content="img/app-icon72x72@2x.png">
		<meta name="msapplication-TileColor" content="#0e90d2">
		
		<link rel="stylesheet" href="css/amazeui.css">
		<link rel="stylesheet" href="css/app.css">
		
		
		<script language="JavaScript" src="js/jquery-3.2.1.js"></script>
		<script language="JavaScript" src="js/amazeui.js"></script>
		
		<style type="text/css">
			img{
				width: 100px;
  				height: 100px;
			}
		</style>
	</head>
	<body>
		<!--<form>
			<fieldset>-->
				<legend>违规举报</legend>
				<div class="am-form-group">
					<label for="doc-license-mobile">车牌号码</label>
					<input type="text" id="carNum" name="carNum" placeholder="请您输入车牌号码" required="required"/>
				</div>
					
				<div class="am-form-group am-form-file">
				  <label for="name">上传图片</label>
				  <div>
					  <span class="am-form-group am-form-file">
					  	<img id="image" src="img/uploadimag.jpg"/>
					  	<input id="image_upload" name="image_upload" type="file" accept="image/*"/>
					  	<small style="color: #dd4b39;display: none;">请上传照片</small>
					  </span>
					  <span class="am-form-group am-form-file">
					  	<img id="image_2" src="img/uploadimag.jpg"/>
					  	<input id="image_upload_2" name="image_upload_2" type="file" />
					  	<small style="color: #dd4b39;display: none;">请上传照片</small>
					  </span>
					  <span class="am-form-group am-form-file"> 
					  	<img id="image_3" src="img/uploadimag.jpg"/>
					  	<input id="image_upload_3" name="image_upload_3" type="file"/>
					  	<small style="color: #dd4b39;display: none;">请上传照片</small>
					  </span>
				  </div>
				</div>
				
				
				<div class="am-form-group">
					<label for="doc-ta-1">原因描述</label>
					<textarea rows="5" id="description" name="description"></textarea>
				</div>
				
				<p><button type="submit" class="am-btn am-btn-default submit">提交</button></p>
			<!--</fieldset>
		</form>-->
		
		<div class="am-modal am-modal-confirm" tabindex="-1" id="my-confirm">
		  <div class="am-modal-dialog">
		    <div class="am-modal-hd"></div>
		    <div class="am-modal-footer">
		      <span class="am-modal-btn" data-am-modal-cancel>取消</span>
		      <span class="am-modal-btn" data-am-modal-confirm>确定</span>
		    </div>
		  </div>
		</div>
	</body>
	
	<script language="JavaScript">
		
		//获取url中参数
		function getUrlParam(name) {
	      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
	      var r = window.location.search.substr(1).match(reg); //匹配目标参数
	      if (r != null) return unescape(r[2]); return null; //返回参数值
	    }
		
		function upload(inputId, imageId){
			$("#" + inputId).on("change",function(){
		    	if(typeof(FileReader) != "undefined"){
		    		var regex = /(.jpg|.jpeg|.gif|.png|.bmp)$/;
		    		$($(this)[0].files).each(function(){
		    			var file = $(this);
		    			if(regex.test(file[0].name.toLowerCase())){
		    				var reader = new FileReader();
		    				reader.onload = function(e){
		    					$("#" + imageId).attr("src", e.target.result);
		    				}
		    				reader.readAsDataURL(file[0]);
		    			}else{
		    				$("#my-confirm .am-modal-hd").html(file[0].name + "is not a valid image file.");
		    				$("#my-confirm").modal({
		    					onConfirm:function(){
		    						
		    					}
		    				})
		    				return false;
		    			}
		    		})
		    	}
		    })
		}
		
		
		$(document).ready(function(){
			
			var url = "http://47.93.237.6:8080/wheelchair/getData.jsp";
			var lotId = getUrlParam("lotId");
			var uid = getUrlParam("uid");
			
		    
		    upload("image_upload", "image");
		    upload("image_upload_2", "image_2");
		    upload("image_upload_3", "image_3");
		    
		    $(".submit").on("click", function(){
		    	var carNum = $("#carNum").val();
			    var description = $("#description").val();
			    var image_upload = $("#image_upload")[0].files[0];
			   	var image_upload_2 = $("#image_upload_2")[0].files[0];
			   	var image_upload_3 = $("#image_upload_3")[0].files[0];
			    
			    
		    	var fname = "reportViolation";
			    var fparam = '{"description":"'+description +'","carNum":"'+carNum+'","lotId":"'+lotId+'","uid":"'+uid+'"}';
			    
			    var formData = new FormData();
			    formData.append("file1", image_upload);
			    formData.append("file2", image_upload_2);
			    formData.append("file3", image_upload_3);
			    formData.append("fname", fname);
			    formData.append("fparam", fparam);
			    
		    	$.ajax({
		    		url:url,
		    		type:"post",
					async:false,
					cache:false,
					contentType:false,
					processData:false,
					data:formData,
					success:function(data){
						var jsonData = JSON.parse(data);
						if(jsonData.success == 1 && jsonData.result.reportId != ""){
							$(location).attr("href","menu.html?uid=" + uid + "&lotId=" + lotId);
						}
					}
		    	})
				
		   
		    })
		})
	</script>
</html>
